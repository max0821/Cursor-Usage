# Cursor 用量統計面板 (Cursor Usage Stats Panel)

這是一個 [Tampermonkey](https://www.tampermonkey.net/) 使用者腳本，專為 [Cursor](https://cursor.com) 設計。它會在您的儀表板頁面 (`/dashboard`) 新增一個功能強大的浮動統計面板，讓您能夠深入分析您的 AI 模型使用量、花費以及趨勢。

![腳本介面截圖](https://i.imgur.com/your_screenshot_link.png)
*(您可以在此處替換為您自己的截圖連結，例如您之前提供的 `image_dd39ea.png`)*

---

## ✨ 功能亮點

這個腳本解決了官方儀表板缺乏詳細統計和趨勢分析的問題，提供了以下核心功能：

- **📊 互動式浮動面板**:
  - 介面可隨意拖動，位置自由。
  - 所有數據都在同一個面板中呈現，一目了然。

- **📈 詳細數據統計**:
  - **請求次數**: 統計所有成功計費的請求。
  - **Token 分析**: 精確計算輸入、輸出、快取讀取和快取寫入的 Token 總量。
  - **總花費**: 加總所有費率，提供精確到小數點後四位的美元花費。

- **📅 彈性的日期查詢**:
  - **快速按鈕**: 提供「今天」、「7 天」、「30 天」的常用時間範圍供您一鍵查詢。
  - **自訂日期選擇器**: 支援互動式月曆，您可以自由選取任何時間區間進行查詢。
  - **智慧記憶**: 自動儲存您上次查詢的日期範圍，下次打開頁面時會自動載入。

- **📉 視覺化趨勢圖**:
  - 內建基於 [Chart.js](https://www.chartjs.org/) 的每日花費折線圖。
  - 將您的總花費按天呈現，讓您輕鬆掌握使用量的高峰與低谷。

- **🚀 強大且可靠的數據獲取**:
  - **自動翻頁**: 當用量紀錄超過一頁時，腳本會自動在背景請求所有分頁並合併數據，確保統計 100% 完整。
  - **智慧過濾**: 自動排除所有未計費、錯誤、或由您個人 API Key 產生的請求，確保統計範圍的純粹性。
  - **時區同步**: 所有日期計算均以 **UTC+0** 為標準，與 Cursor 官方後台的邏輯完全一致，消除了時差導致的數據偏差。

---

## 🔧 安裝教學

1.  **安裝使用者腳本管理器**:
    - 您需要在您的瀏覽器上先安裝一個使用者腳本管理器。最推薦的是 [Tampermonkey](https://www.tampermonkey.net/)，它支援 Chrome, Firefox, Edge, Safari 等主流瀏覽器。

2.  **安裝本腳本**:
    - 點擊 Tampermonkey 的圖示，選擇「新增腳本...」(Add a new script...)。
    - 將本腳本的完整程式碼（`// ==UserScript==` 到結尾的 `})();`）**全部複製**並**貼上**到編輯器中，取代原有的模板內容。
    - 按下 `Ctrl + S` 或點擊「檔案」->「儲存」來保存腳本。

---

## 📖 使用指南

1.  安裝並啟用腳本後，打開或重新整理您的 [Cursor 儀表板頁面](https://cursor.com/cn/dashboard)。
2.  腳本的浮動面板會自動出現在畫面的左下角。
3.  **快速查詢**:
    - 點擊「今天」、「7 天」或「30 天」按鈕，腳本會立即查詢並顯示對應時間範圍的數據。被選中的按鈕會高亮顯示。
4.  **自訂查詢**:
    - 點擊下方的兩個日期輸入框，會彈出月曆。
    - 分別選擇您想要的「開始日期」和「結束日期」。
    - 點擊右側的「查詢」按鈕，即可分析您自訂的時間範圍。
5.  **查看結果**:
    - 面板上方的表格會顯示詳細的統計總數。
    - 面板下方的圖表會顯示每日的花費趨勢。
6.  **移動面板**:
    - 按住面板最上方的標題欄，即可將其拖動到螢幕上的任何位置。

---

## 📜 版本歷史 (摘要)

我們透過多次迭代，共同打造了這個功能完善的工具：
- **v1-v3**: 初版，嘗試透過攔截網頁請求來獲取數據，但遇到了困難。
- **v4**: 重大轉變，改為主動發送請求，並加入了手動查詢按鈕。
- **v5**: 解決了 `Origin` 和 `Referer` Header 的問題，讓請求能被伺服器接受。
- **v6**: 實現了**自動翻頁**功能，確保了數據的完整性。
- **v7**: 新增了 **Chart.js 圖表**和多項**計算優化**，使腳本功能和精確度大幅提升。
- **v8**: 最終版，引入了 **flatpickr 日期選擇器**和**日期記憶功能**，成為一個功能完整的分析工具。

---

## 📄 授權

本腳本採用 [MIT License](https://opensource.org/licenses/MIT) 授權。
